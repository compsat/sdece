<!DOCTYPE html>
<html>
	<head>
		<title>Add Location</title>

		<!-- Import Tailwind CSS output file -->
		<link href="./src/output.css" rel="stylesheet" />

		<!-- Import Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap"
			rel="stylesheet"
		/>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
			rel="stylesheet"
		/>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Hind:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>

		<script type="module">
			//import { addLocation } from "./js/firestore.js";
			import {
				addEntry,
				SDECE_RULES_TEST,
				setCollection,
				validateData
			} from '/firestore_UNIV.js';
			

			setCollection('sdece-official-TEST');

			document.addEventListener("DOMContentLoaded", function() {
                document.getElementById("submit_form").addEventListener("click", handleFormSubmit_v2);
            });
				// .addEventListener('click', handleFormSubmit_v3);

			function handleFormSubmit_v2() {
				console.log('clicked');
				var collatedInput = {};

				// for (let i = 0; i < SDECE_RULES_TEST[2].length; i++) {
				// 	//SDECE_RULES_TEST[2] are just the field names of each document
				// 	console.log(SDECE_RULES_TEST[2][i]);
				// 	let q = document.getElementById(
				// 		SDECE_RULES_TEST[2][i]
				// 	).value;
				// 	collatedInput[SDECE_RULES_TEST[2][i]] = q;

				// 	// this is where data validation will happen
				// 	// add the if-else statements of edge cases here
				// }

				for (let i = 0; i < SDECE_RULES_TEST[2].length; i++){
					console.log(SDECE_RULES_TEST[2][i]);

					let fieldName = SDECE_RULES_TEST[2][i];
					let inputValue = document.getElementById(fieldName).value;

					collatedInput[fieldName] = inputValue;
				}

				console.log(collatedInput);
				// This actually works but it needs some data validation
				// uncomment at the db's risk
				// addEntry(collatedInput);

				const errors = validateData("sdece-official-TEST", collatedInput);

				if (errors.length > 0) {
					displayErrors(errors);
				} else {
					addEntry(collatedInput);
					console.log("Entry added!");
				}

				function displayErrors(errors) {
					let errorDiv = document.getElementById('error_messages');

					if (errorDiv) {
						errorDiv.innerHTML = '';

						if (errors.length > 0) {
							for (let error of errors) {
								let errorParagraph = document.createElement('p');
								errorParagraph.textContent = error;
								errorDiv.appendChild(errorParagraph);
							}
						} else {
							console.error("Error: Couldn't find element with ID 'error_messages'.");
						}
					}
					
				}

			}
			
		</script>
	</head>
	<body>
		<form
			action=""
			id="addLocForm"
			class="flex flex-row justify-center items-center z-[99999999999999999999] bg-customLightGray"
		>
			<div class="p-8 overflow-y-scroll rounded-lg w-full">
				<!-- Header -->
				<div class="flex flex-row justify-between mb-8 items-center">
					<h1 class="font-montserrat text-3xl font-bold text-darkbg">
						Add Activity
					</h1>
					<button id="close-btn">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							fill="none"
							viewBox="0 0 24 24"
							stroke-width="1.5"
							class="size-8 stroke-customDarkGray"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								d="M6 18 18 6M6 6l12 12"
							/>
						</svg>
					</button>
				</div>

				<!-- General Information -->
				<div class="">
					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="activity_name"
							>Activity Name
						</label>
						<input
							type="text"
							id="activity_name"
							name="activity_name"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="activity_nature"
							>Nature of Activity
						</label>
						<input
							type="text"
							id="activity_nature"
							name="activity_nature"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between w-full mb-6">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="activity_date"
							>Dates of Partnership
						</label>
						<div class="flex flex-col items-start" id="date-container">
							<input
								type="Date"
								id="activity_date"
								name="activity_date"
								class="py-4 px-8 w-96 rounded border font-montserrat"
								placeholder=""
							/>
							<a
								href=""
								class="text-base font-montserrat text-lightbg underline mt-4"
								id="add-date"
								>Add another date
						</a>	
						</div>
					</div>
				</div>

				<!-- PARTNER INFORMATION -->
				<div class="">
					<h2 class="w-full text-lightbg font-montserrat text-xl mt-10 font-bold mb-6">
						PARTNER INFORMATION
					</h2>
					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="additional_partnership"
							>Additional Partnership
						</label>
						<input
							type="text"
							id="additional_partnership"
							name="additional_partnership"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="organization_unit"
							>Organization Unit
						</label>
						<input
							type="text"
							id="organization_unit"
							name="organization_unit"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="partner_name"
							>Name of Host Partner
						</label>
						<input
							type="text"
							id="partner_name"
							name="partner_name"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="partner_address"
							>Address of Host Partner
						</label>
						<input
							type="text"
							id="partner_address"
							name="partner_address"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="partner_contact_name"
							>Name of Contact Person
						</label>
						<input
							type="text"
							id="partner_contact_name"
							name="partner_contact_name"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="partner_contact_number"
							>Number of Contact Person
						</label>
						<input
							type="text"
							id="partner_contact_number"
							name="partner_contact_number"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="partner_email"
							>Email of Contact Person / Partner
						</label>
						<input
							type="email"
							id="partner_email"
							name="partner_email"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="partner_coordinates"
							>Coordinates
						</label>
						<input
							type="geopoint"
							id="partner_coordinates"
							name="partner_coordinates"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>
				</div>

				<div class="">
					<h2 class="w-full text-lightbg font-montserrat text-xl mt-10 font-bold mb-6">
						ATENEO OFFICE OVERSIGHT
					</h2>

					<div xclass="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="ADMU_office"
							>Name of OFFICE
						</label>
						<input
							type="text"
							id="ADMU_office"
							name="ADMU_office"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between mb-6 items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="ADMU_contact_name"
							>Name of Ateneo Contact Person
						</label>
						<input
							type="text"
							id="ADMU_contact_name"
							name="ADMU_contact_name"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>

					<div class="flex flex-row justify-between items-center">
						<label
							class="form font-montserrat text-xl text-customGray flex-1 pr-12"
							for="ADMU_email"
							>Email of Ateneo Contact Person
						</label>
						<input
							type="email"
							id="ADMU_email"
							name="ADMU_email"
							class="py-4 px-8 w-96 rounded border font-montserrat"
							placeholder=""
						/>
					</div>
				</div>

				<!-- Buttons -->
				<div class="button_div py-8 mt-8">
					<!-- Clears all contents of the form -->
					<button
						class="w-full py-4 text-center font-montserrat text-2xl bg-lightbg text-white font-bold rounded-lg"
						type="submit"
						id="submit_form"
						name="submit_form"
					>Save
					</button>
					<button
						class="w-full py-4 text-center font-montserrat text-2xl text-red-700 font-bold border border-red-700 rounded-lg mt-4"
					>Delete
					</button>
				</div>
				<div id="error_messages"></div>
    
            <br><br>
			</div>
		</form>

		<script>
			document
				.getElementById('addLocForm')
				.addEventListener('submit', function (event) {
					event.preventDefault(); // Prevent the default form submission

					// Simulate successful submission (replace with actual form submission code)
					// Example: Submit form data via AJAX or fetch API

					// Assuming form submission is successful
					// Notify parent window (where the iframe is embedded)
					window.parent.postMessage(
						{ type: 'addlocFormSuccess' },
						'*'
					);
				});

			document
				.getElementById('add-date')
				.addEventListener('click', function (event) {
					event.preventDefault();
					var dateContainer =
						document.getElementById('date-container');
					var newDateInput = document.createElement('input');
					newDateInput.type = 'date';
					newDateInput.name = 'activity_date';
					newDateInput.className =
						'py-4 px-8 w-96 rounded border font-montserrat mt-2';
					dateContainer.insertBefore(newDateInput, this);
				});

			document
				.getElementById('close-btn')
				.addEventListener('click', function (event) {
					event.preventDefault();
					console.log(
						'The user has closed the Add Activity modal.'
					);
					window.parent.postMessage('closeAddModal', '*');
				});
		</script>

	</body>
</html>