<!DOCTYPE html>
<html>
    <head>
        <title>Add Location</title>
        <link rel="stylesheet" href="./css/form.css">
            
        <script type="module">
            //import { addLocation } from "./js/firestore.js";
            import { addEntry, BUKLOD_RULES, setCollection } from "/firestore_UNIV.js";
            setCollection("buklod-official");
            document.getElementById("submit_form").addEventListener("click", handleFormSubmit_v2);

            /*function handleFormSubmit() {
                const urlParams = new URLSearchParams(window.location.search);
                var latitude = urlParams.get('lat');
                var longitude = urlParams.get('lng');
                var partner = document.getElementById("partner").value;
                var partnerContactPerson = document.getElementById("partner_contact-person").value;
                var organization = document.getElementById("organization").value;
                var natureOfActivity = document.getElementById("nature_of_act").value;
                var datesOfPartnership = document.getElementById("dates_of_partnership").value;
                var ateneoOffice = document.getElementById("ateneo_office").value;
                var ateneoContactPerson = document.getElementById("ateneo_contact-person").value;
                var ateneoContactEmail = document.getElementById("ateneo_contact-email").value;
                
                // Parse the date input as a whole string
                var dateParts = datesOfPartnership.split("-");
                var year = dateParts[0];
                var month = dateParts[1];
                var day = dateParts[2];
                var parsedDatesOfPartnership = year + "-" + month + "-" + day;

                addLocation(
                    partner, 
                    natureOfActivity,
                    ateneoContactPerson,
                    ateneoContactEmail,
                    ateneoOffice,
                    organization,
                    partnerContactPerson,
                    parsedDatesOfPartnership,
                    latitude,
                    longitude
                );
                
                document.getElementById("partner").value = "";
                document.getElementById("partner_contact-person").value = "";
                document.getElementById("organization").value = "";
                document.getElementById("nature_of_act").value = "";
                document.getElementById("dates_of_partnership").value = "";
                document.getElementById("ateneo_office").value = "";
                document.getElementById("ateneo_contact-person").value = "";
                document.getElementById("ateneo_contact-email").value = "";
                
                // Display a success message
                alert("Form submitted successfully!");
            } */

            function handleFormSubmit_v2(){
                console.log("clicked");
                var collatedInput = {};

                //var latitude = urlParams.get('lat');
                //var longitude = urlParams.get('lng');

                for(let i = 0; i < BUKLOD_RULES[2].length; i++){
                    let q = document.getElementById(BUKLOD_RULES[2][i].value);
                    collatedInput[BUKLOD_RULES[2][i]] = q;
                }

                /*for(field of BUKLOD_RULES[2]){
                    let q = null;
                    if(field == "location_coordinates"){
                        q = "[" + latitude + ", " + longitude + "]";
                    }
                    else if (field == "location_link"){
                        let link_start = "https://www.openstreetmap.org/#map=16/";
                        q = linkstart + latitude + "/" + longitude;
                    }
                    else {
                        q = document.getElementById(BUKLOD_RULES[2][i].value);
                    }
                    console.log(q);
                    collatedInput[BUKLOD_RULES[2][i]] = q;
                } */

                console.log(collatedInput);
                // This actually works but it needs some data validation
                // uncomment at the db's risk
                // addEntry(collatedInput);
            }
        </script>
    </head>
    
    <body>
        <br>
        <div class="container"> 
            <!-- Div for margin -->
            <h1 class="form-header">Add Household</h1>
            <br>
            
            <h2 class="sub-header">HOUSEHOLD INFORMATION</h2>
            <br>
            <!-- Form -->
            <div class="input_container">
                <label class="form" for="household_name">Household Name</label>
                <input type="text" id="household_name" name="household_name" class="attribs" placeholder="">
            </div>
        
            <br>

            <div class="input_container">
                <label class="form" for="household_address">Address</label>
                <input type="text" id="household_address" name="household_address" class="attribs" placeholder="">    
            </div>
            
            <br>

            <div class="input_container">
                <label class="form" for="household_phase">Phase</label>
                <input type="text" id="household_phase" name="household_phase" class="attribs" placeholder="">    
            </div>
            
            <br>
    
            <div class="input_container">
                <label class="form" for="contact_number">Contact Number</label>
                <input type="text" id="contact_number" name="contact_number" class="attribs" placeholder="">    
            </div>
            
            <br>
    
            <div class="input_container">
                <label class="form" for="residency_status">Residency Status</label>
                <input type="text" id="residency_status" name="residency_status" class="attribs" placeholder=""> 
            </div>
            
            <br>

            <div class="input_container">
                <label class="form" for="is_hoa_noa">Part of HOA / NOA</label>
                <input type="text" id="is_hoa_noa" name="is_hoa_noa" class="attribs" placeholder=""> 
            </div>
            
            <br>
    
            <!-- Pressing a button adds another date -->

            <div class="input_container">
                <label class="form" for="household_material">Materials Used for House</label>
                <input type="text" id="household_material" name="household_material" class="attribs" placeholder=""> 
            </div>
            
            <br>
    
            <div class="input_container">
                <label class="form" for="nearest_evac">Nearest Evactuation Area</label>
                <input type="text" id="nearest_evac" name="nearest_evac" class="attribs" placeholder="">    
            </div>
            
            <br>

            <h2 class="sub-header">RESIDENT INFORMATION</h2>
            <br>
    
            <div class="input_container">
                <label class="form" for="number_residents">Number of Residents</label>
                <input type="text" id="number_residents" name="number_residents" class="attribs" placeholder="">    
            </div>
            
            <br>
    
            <div class="input_container">
                <label class="form" for="number_minors">Number of Minor Residents</label>
                <input type="text" id="number_minors" name="number_minors" class="attribs" placeholder="">
            </div>

            <br>

            <div class="input_container">
                <label class="form" for="number_seniors">Number of Senior Citizen Residents</label>
                <input type="text" id="number_seniors" name="number_seniors" class="attribs" placeholder="">
            </div>

            <br>

            <div class="input_container">
                <label class="form" for="number_pwd">Number of PWD Residents</label>
                <input type="text" id="number_pwd" name="number_pwd" class="attribs" placeholder="">
            </div>

            <br>

            <div class="input_container">
                <label class="form" for="number_sick">Number of Sick Residents</label>
                <input type="text" id="number_sick" name="number_sick" class="attribs" placeholder="">
            </div>
            
            <br>

            <div class="input_container">
                <label class="form" for="number_pregnant">Number of Pregnant Residents</label>
                <input type="text" id="number_pregnant" name="number_pregnant" class="attribs" placeholder="">
            </div>

            <br>

            <h2 class="sub-header">RISK LEVELS</h2>
            <br>

            <div class="input_container">
                <label class="disaster-form" for="earthquake">Earthquake</label>
                <select name="earthquake_level" id="earthquake" class="attribs">
                    <option value="" disabled selected hidden></option>
                    <option value="high">HIGH</option>
                    <option value="medium">MEDIUM</option>
                    <option value="low">LOW</option>
                </select>
                <input type="text" id="earthquake_risk" name="earthquake_risk" class="attribs" placeholder="">
            </div>

            <br>

            <div class="input_container">
                <label class="disaster-form" for="fire">Fire</label>
                <select name="fire_level" id="fire" class="attribs">
                    <option value="" disabled selected hidden></option>
                    <option value="high">HIGH</option>
                    <option value="medium">MEDIUM</option>
                    <option value="low">LOW</option>
                </select>
                <input type="text" id="fire_risk" name="fire_risk" class="attribs" placeholder="">
            </div>

            <br>
            
            <div class="input_container">
                <label class="disaster-form" for="flood">Flood</label>
                <select name="flood_level" id="flood" class="attribs">
                    <option value="" disabled selected hidden></option>
                    <option value="high">HIGH</option>
                    <option value="medium">MEDIUM</option>
                    <option value="low">LOW</option>
                </select>
                <input type="email" id="flood_risk" name="flood" class="attribs" placeholder="">
            </div>

            <br>
            
            <div class="input_container">
                <label class="disaster-form" for="landslide">Landslide</label>
                <select name="landslide_level" id="landslide" class="attribs">
                    <option value="" disabled selected hidden></option>
                    <option value="high">HIGH</option>
                    <option value="medium">MEDIUM</option>
                    <option value="low">LOW</option>
                </select>
                <input type="email" id="landslide_risk" name="landslide" class="attribs" placeholder="">
            </div>

            <br>

            <div class="input_container">
                <label class="disaster-form" for="storm">Storm</label>
                <select name="storm_level" id="storm" class="attribs">
                    <option value="" disabled selected hidden></option>
                    <option value="high">HIGH</option>
                    <option value="medium">MEDIUM</option>
                    <option value="low">LOW</option>
                </select>
                <input type="email" id="storm_risk" name="storm_risk" class="attribs" placeholder="">
            </div>

            <br>

            <br><br>
    
            <!-- Buttons -->
            <div>
                <!-- Submits contents of the form -->                                               
                <button class="confirm form" type="submit" id="submit_form" name="submit_form">Save</button>   
            </div>
            <br>
            <div>
                <!-- Clears all contents of the form -->
                <button class="clear form">Delete</button>
            </div>
        </div>

    </body>  
</html>