<!DOCTYPE html>
<html>

<head>
    <title>Edit Location</title>
    <link rel="stylesheet" href="./css/form.css">

    <script type="module">
        import { editLocation, getDocIdByPartnerName, getDocByID } from "./js/firestore.js";
        function populateFormFields(partnerData) {
            document.getElementById("partner").value = partnerData.name;
            document.getElementById("partner_contact-person").value = partnerData["`partner-contact`"];
            document.getElementById("organization").value = partnerData.org;
            document.getElementById("nature_of_act").value = partnerData.activity;
            document.getElementById("dates_of_partnership").value = partnerData.dates;
            document.getElementById("ateneo_office").value = partnerData["`admu-office`"];
            document.getElementById("ateneo_contact-person").value = partnerData["`admu-contact`"];
            document.getElementById("ateneo_contact-email").value = partnerData["`admu-email`"];
        }
        function fetchPartnerData() {
            const params = new URLSearchParams(window.location.search);
            const partnerName = params.get("partnerName");
            if (partnerName) {
                getDocIdByPartnerName(partnerName)
                    .then((docId) => {
                        if (docId) {
                            getDocByID(docId).then((doc) => {
                                populateFormFields(doc);
                            });
                        }
                        else {
                            alert("No matching document found for the partner name: " + partnerName);
                        }
                    });
            }
            else {
                alert("No partnerName parameter found in the URL.");
            }
        }
        fetchPartnerData();

        document.getElementById("submit_form").addEventListener("click", handleFormSubmit);

        function handleFormSubmit() {
            const partnerName = document.getElementById("partner").value;
            getDocIdByPartnerName(partnerName)
                .then((docId) => {
                    if (docId) {
                        // If a matching docId is found, proceed with updating the document
                        const name = partnerName;
                        const activity = document.getElementById("nature_of_act").value;
                        const admuContact = document.getElementById("ateneo_contact-person").value;
                        const admuEmail = document.getElementById("ateneo_contact-email").value;
                        const admuOffice = document.getElementById("ateneo_office").value;
                        const org = document.getElementById("organization").value;
                        const partnerContact = document.getElementById("partner_contact-person").value;
                        const dates = document.getElementById("dates_of_partnership").value;

                        editLocation(docId, name, activity, admuContact, admuEmail, admuOffice, org, partnerContact, dates);
                    }
                    else {
                        // Handle case when no matching document is found
                        alert("No matching document found for the partner name: " + partnerName);
                    }
                });

        }
    </script>
</head>

<body>
        <!-- Modal Header: includes title and address -->
        <div class="formModalHeader">
          <span class="closeEditForm">&times;</span>
          <h1 class="formHeader">Edit Household</h1>
        </div>
        <!-- Modal Content: everything else -->
        <div class="formModalContent">
          <h2 class="subHeader">HOUSEHOLD INFORMATION</h2>
          <br>
          <!-- Form Proper -->
          <div class="inputContainer">
              <label class="form" for="household_name">Household Name</label>
              <input type="text" id="edit_household_name" name="household_name" class="attribs">
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="address">Address</label>
              <input type="text" id="edit_address" name="address" class="attribs">    
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="contact_number">Contact Number</label>
              <input type="text" id="edit_contact_number" name="contact_number" class="attribs">    
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="residency_status">Residency Status</label>
              <input type="text" id="edit_residency_status" name="residency_status" class="attribs"> 
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="HOA/NOA">Part of HOA / NOA</label>
              <input type="text" id="edit_HOA/NOA" name="HOA/NOA" class="attribs"> 
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="nearest_evacuation_area">Nearest Evacuation Area</label>
              <input type="text" id="edit_nearest_evacuation_area" name="nearest_evacuation_area" class="attribs">    
          </div>
          <br>
          <h2 class="subHeader">RESIDENT INFORMATION</h2>
          <br>
          <div class="inputContainer">
              <label class="form" for="number_of_residents">Number of Residents</label>
              <input type="text" id="edit_number_of_residents" name="number_of_residents" class="attribs">    
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="number_of_minor_residents">Number of Minor Residents</label>
              <input type="text" id="edit_number_of_minor_residents" name="number_of_minor_residents" class="attribs">
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="number_of_senior_residents">Number of Senior Citizen Residents</label>
              <input type="text" id="edit_number_of_senior_residents" name="number_of_senior_residents" class="attribs">
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="number_of_pwd_residents">Number of PWD Residents</label>
              <input type="text" id="edit_number_of_pwd_residents" name="number_of_pwd_residents" class="attribs">
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="number_of_sick_residents">Number of Sick Residents</label>
              <input type="text" id="edit_number_of_sick_residents" name="number_of_sick_residents" class="attribs">
          </div>
          <br>
          <div class="inputContainer">
              <label class="form" for="number_of_pregnant_residents">Number of Pregnant Residents</label>
              <input type="text" id="edit_number_of_pregnant_residents" name="number_of_pregnant_residents" class="attribs">
          </div>
          <br>
          <h2 class="subHeader">RISK LEVELS</h2>
          <br>
          <div class="inputContainer">
              <label class="disasterForm" for="earthquake">Earthquake</label>
              <select name="earthquake_level" id="edit_earthquake_risk_level" class="attribs">
                  <option id="default_earthquake" value="" disabled selected hidden></option>
                  <option value="high">HIGH</option>
                  <option value="medium">MEDIUM</option>
                  <option value="low">LOW</option>
              </select>
              <input type="text" id="edit_earthquake_desc" name="earthquake" class="attribs">
          </div>
          <br>
          <div class="inputContainer">
              <label class="disasterForm" for="fire">Fire</label>
              <select name="fire_level" id="edit_fire_risk_level" class="attribs">
                  <option id="default_fire" value="" disabled selected hidden></option>
                  <option value="high">HIGH</option>
                  <option value="medium">MEDIUM</option>
                  <option value="low">LOW</option>
              </select>
              <input type="text" id="edit_fire_desc" name="fire" class="attribs">
          </div>
          <br>
          <div class="inputContainer">
              <label class="disasterForm" for="flood">Flood</label>
              <select name="flood_level" id="edit_flood_risk_level" class="attribs">
                  <option id="default_flood" value="" disabled selected hidden></option>
                  <option value="high">HIGH</option>
                  <option value="medium">MEDIUM</option>
                  <option value="low">LOW</option>
              </select>
              <input type="email" id="edit_flood_desc" name="flood" class="attribs">
          </div>
          <br>
          <div class="inputContainer">
              <label class="disasterForm" for="landslide">Landslide</label>
              <select name="landslide_level" id="edit_landslide_risk_level" class="attribs">
                  <option id="default_landslide" value="" disabled selected hidden></option>
                  <option value="high">HIGH</option>
                  <option value="medium">MEDIUM</option>
                  <option value="low">LOW</option>
              </select>
              <input type="email" id="edit_landslide_desc" name="landslide" class="attribs">
          </div>
          <br>
          <div class="inputContainer">
              <label class="disasterForm" for="storm">Storm</label>
              <select name="storm_level" id="edit_storm_risk_level" class="attribs">
                  <option id="default_storm" value="" disabled selected hidden></option>
                  <option value="high">HIGH</option>
                  <option value="medium">MEDIUM</option>
                  <option value="low">LOW</option>
              </select>
              <input type="email" id="edit_storm_desc" name="storm" class="attribs">
          </div>
          <!-- save and Delete buttons -->
          <div class="buttonContainer">
            <div>
              <!-- submits contents of the form -->                                               
              <button class="confirm form" type="submit" id="submit_form" name="submit_form">Save</button>   
            </div>
            <div>
              <!-- clears all contents of the form -->
              <button class="clear form">Delete</button>
            </div>
          </div>
        </div>
        <!-- modal Footer: empty space -->
         <div class="formModalFooter"></div>
</body>  

</html>